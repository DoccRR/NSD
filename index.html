<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NSD Snake</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      background: black;
      color: white;
      font-family: "Orbitron", sans-serif;
      overflow: hidden;
    }

    /* ===== Carrusel ===== */
    .carousel-container {
      display: flex;
      overflow-x: hidden;
      scroll-behavior: smooth;
      width: 100vw;
      height: 100vh;
    }
    .slide {
      flex: 0 0 100%;
      height: 100vh;
      background-size: cover;
      background-position: center;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 3em;
      text-shadow: 0 0 10px black;
    }

    /* Flechas */
    .arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2em;
      background: rgba(0,0,0,0.5);
      border: none;
      color: white;
      cursor: pointer;
      z-index: 10;
      padding: 10px;
    }
    .arrow.left { left: 10px; }
    .arrow.right { right: 10px; }

    /* ===== Snake styles ===== */
    #snakeWrap {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
    }
    #snakeCanvas {
      background: black;
      display: block;
      border: 2px solid white;
    }
    #gameOverOverlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 2em;
      z-index: 20;
    }

    /* ===== Controles de música ===== */
    #controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 15;
    }
    #controls button,
    #controls input[type=range] {
      font-size: 1em;
      padding: 6px 10px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- Flechas -->
  <button class="arrow left" onclick="scrollCarousel(-1)">&#10094;</button>
  <button class="arrow right" onclick="scrollCarousel(1)">&#10095;</button>

  <!-- Carrusel -->
  <div id="carousel" class="carousel-container">
    <!-- 0 → Welcome -->
    <div class="slide" style="background-image:url('NSD.jpg')">WELCOME</div>
    <!-- 1 → BUY MUSIC -->
    <div class="slide" style="background-image:url('bandcamp.png')">BUY MUSIC</div>
    <!-- 2 → YouTube -->
    <div class="slide" style="background-image:url('youtube.png')">YOUTUBE</div>
    <!-- 3 → Spotify -->
    <div class="slide" style="background-image:url('spotify.png')">SPOTIFY</div>
    <!-- 4 → SoundCloud -->
    <div class="slide" style="background-image:url('soundcloud.png')">SOUNDCLOUD</div>
    <!-- 5 → Bookings -->
    <div class="slide" style="background-image:url('bookings.png')">BOOKINGS</div>
    <!-- 6 → Instagram -->
    <div class="slide" style="background-image:url('instagram.png')">INSTAGRAM</div>
    <!-- 7 → Snake -->
    <div class="slide" style="background:black; flex-direction:column;">
      <div id="snakeWrap">
        <canvas id="snakeCanvas"></canvas>
      </div>
      <div id="gameOverOverlay">
        <div>GAME OVER</div>
        <div id="score">SCORE: 0</div>
        <input id="nicknameInput" placeholder="Your nickname" maxlength="20"/>
        <button id="playAgainBtn">Play Again</button>
      </div>
    </div>
  </div>

  <!-- ===== SoundCloud oculto + controles visibles ===== -->
  <iframe 
    id="scPlayer"
    style="display:none;"
    width="0"
    height="0"
    scrolling="no"
    frameborder="no"
    src="https://w.soundcloud.com/player/?url=https%3A//soundcloud.com/noizesd/"
  </iframe>

  <div id="controls">
    <button id="prevBtn">⏮</button>
    <button id="playPauseBtn">▶</button>
    <button id="nextBtn">⏭</button>
    <input id="volumeSlider" type="range" min="0" max="100" value="80">
  </div>
    <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <!-- SoundCloud API -->
  <script src="https://w.soundcloud.com/player/api.js"></script>

  <script>
  /* ---------------- Firebase Setup ---------------- */
  const firebaseConfig = {
    apiKey: "AIzaSyANmEBw9kBijdWHmxV5cIBHy1patcfAuvA",
    authDomain: "nsdsnake.firebaseapp.com",
    projectId: "nsdsnake",
    storageBucket: "nsdsnake.firebasestorage.app",
    messagingSenderId: "719565977829",
    appId: "1:719565977829:web:94911f469efd29aa9c7c0c",
    databaseURL: "https://nsdsnake-default-rtdb.europe-west1.firebasedatabase.app"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  /* ---------------- Carrusel ---------------- */
  const container = document.getElementById("carousel");
  let currentIndex = 0;

  function scrollCarousel(dir){
    const slides = document.querySelectorAll(".slide");
    const slideWidth = slides[0].getBoundingClientRect().width;
    currentIndex += dir;
    if(currentIndex < 0) currentIndex = 0;
    if(currentIndex >= slides.length) currentIndex = slides.length - 1;
    container.scrollTo({
      left: currentIndex * slideWidth,
      behavior: "smooth"
    });
  }

  // Soporte rueda ratón
  container.addEventListener("wheel", e=>{
    if(e.deltaY > 0) scrollCarousel(1);
    else scrollCarousel(-1);
  });

  // Swipe táctil
  let touchStartX=0;
  container.addEventListener("touchstart", e=>{ touchStartX=e.changedTouches[0].screenX; }, {passive:true});
  container.addEventListener("touchend", e=>{
    let dx=e.changedTouches[0].screenX - touchStartX;
    if(dx > 50) scrollCarousel(-1);
    else if(dx < -50) scrollCarousel(1);
  });

  /* ---------------- Snake Game ---------------- */
  const canvas = document.getElementById("snakeCanvas");
  const ctx = canvas.getContext("2d");
  canvas.width = 400; canvas.height = 400;
  let box = 20;
  let snake, direction, food, score, gameInterval;
  let overlay = document.getElementById("gameOverOverlay");
  let scoreElement = document.getElementById("score");

  function generateFood(){
    let letters = ["N","S","D"];
    return {
      x: Math.floor(Math.random()*19+1)*box,
      y: Math.floor(Math.random()*19+1)*box,
      letter: letters[Math.floor(Math.random()*letters.length)]
    };
  }
  document.addEventListener("keydown",function(e){
    if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"," "].includes(e.key)) e.preventDefault();
    if(e.key=="ArrowLeft" && direction!="RIGHT") direction="LEFT";
    else if(e.key=="ArrowUp" && direction!="DOWN") direction="UP";
    else if(e.key=="ArrowRight" && direction!="LEFT") direction="RIGHT";
    else if(e.key=="ArrowDown" && direction!="UP") direction="DOWN";
  });
  function collision(head,array){ return array.some(p=>head.x===p.x && head.y===p.y); }
  function draw(){
    ctx.fillStyle="black";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    for(let i=0;i<snake.length;i++){
      ctx.fillStyle=(i==0)?"lime":"white";
      ctx.fillRect(snake[i].x,snake[i].y,box,box);
    }
    ctx.fillStyle="white";
    ctx.font="20px Orbitron";
    ctx.fillText(food.letter,food.x+5,food.y+15);

    let head={x:snake[0].x,y:snake[0].y};
    if(direction=="LEFT") head.x-=box;
    if(direction=="UP") head.y-=box;
    if(direction=="RIGHT") head.x+=box;
    if(direction=="DOWN") head.y+=box;

    if(head.x==food.x && head.y==food.y){
      score++;
      scoreElement.innerText="SCORE: "+score;
      food=generateFood();
    }else snake.pop();

    if(head.x<0||head.x>=canvas.width||head.y<0||head.y>=canvas.height||collision(head,snake)){
      clearInterval(gameInterval);
      overlay.style.display="flex";
      saveScore(score);
      return;
    }
    snake.unshift(head);
  }
  function startGame(){
    snake=[{x:9*box,y:10*box}];
    direction=null; score=0; scoreElement.innerText="SCORE: 0";
    food=generateFood(); overlay.style.display="none";
    clearInterval(gameInterval);
    gameInterval=setInterval(draw,100);
  }
  document.getElementById("playAgainBtn").addEventListener("click",startGame);
  startGame();

  /* ---------------- Save Score ---------------- */
  function saveScore(score){
    let nickname=document.getElementById("nicknameInput").value.trim();
    if(!nickname) nickname="Anon";
    db.ref("scores").push({
      nickname:nickname,
      score:score,
      timestamp:Date.now()
    });
  }

  /* ---------------- Ranking ---------------- */
  const rankingDiv = document.createElement("div");
  rankingDiv.id = "ranking";
  rankingDiv.style = "position:absolute;bottom:160px;left:50%;transform:translateX(-50%);color:white;font-size:14px;text-align:center;background:rgba(0,0,0,0.6);padding:6px 12px;border-radius:8px;max-width:90%;";
  document.body.appendChild(rankingDiv);

  function loadRanking(){
    db.ref("scores").orderByChild("score").limitToLast(5).on("value", snapshot=>{
      let scores=[];
      snapshot.forEach(child=>{ scores.push(child.val()); });
      scores.sort((a,b)=>b.score-a.score);
      rankingDiv.innerHTML = "<b>TOP 5 PLAYERS</b><br>" +
        scores.map(s=>`${s.nickname}: ${s.score}`).join("<br>");
    });
  }
  loadRanking();

  /* ---------------- SoundCloud custom controls ---------------- */
  const scIframe = document.getElementById('scPlayer');
  const scWidget = SC.Widget(scIframe);
  let widgetReady = false;
  let isPlaying = false;

  const playPauseBtn = document.getElementById('playPauseBtn');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const volumeSlider = document.getElementById('volumeSlider');

  scWidget.bind(SC.Widget.Events.READY, function(){
    widgetReady = true;
    scWidget.setVolume(parseInt(volumeSlider.value,10));
    playPauseBtn.disabled = false;
    volumeSlider.disabled = false;
  });
  scWidget.bind(SC.Widget.Events.PLAY, ()=>{ isPlaying=true; playPauseBtn.textContent="⏸"; });
  scWidget.bind(SC.Widget.Events.PAUSE, ()=>{ isPlaying=false; playPauseBtn.textContent="▶"; });
  scWidget.bind(SC.Widget.Events.FINISH, ()=>{ isPlaying=false; playPauseBtn.textContent="▶"; });

  playPauseBtn.addEventListener("click", ()=>{
    if(!widgetReady) return;
    if(isPlaying) scWidget.pause(); else scWidget.play();
  });
  prevBtn.addEventListener("click", ()=>{ if(widgetReady) scWidget.prev(); });
  nextBtn.addEventListener("click", ()=>{ if(widgetReady) scWidget.next(); });
  volumeSlider.addEventListener("input", e=>{
    if(widgetReady) scWidget.setVolume(parseInt(e.target.value,10));
  });
  </script>
</body>
</html>
